@startuml
skinparam linetype ortho

interface Serializable
interface Comparable

class Application 

class View {
  ' Campi Statici (Stato)
    - mainStage : Stage {static}
    - model : Model {static}
    
    ' Metodi del Ciclo di Vita (JavaFX)
    + start(stage: Stage): void
    + main(args: String[]): void {static}
    
    ' Metodi di Navigazione Principali 
    + Homepage(): void {static}
    + Login(): void {static}
    + Modify(): void {static}
    
    ' Metodi di Navigazione per la Gestione UTENTI
    + addUser(): void {static}
    + modifyUser(): void {static}
    + deleteUser(): void {static}
    + searchUser(): void {static}
    + viewUSers(): void {static}
    
    ' Metodi di Navigazione per la Gestione LIBRI
    + addBook(): void {static}
    + deleteBook(): void {static}
    + updateBook(bookToModify: Book): void {static}
    + updateBook(): void {static}
    + viewBooks(): void {static}
    + searchBook(): void {static}
    
    ' Metodi di Navigazione per la Gestione PRESTITI
    + searchLoan(): void {static}
    + addLoan(): void {static}
    + deleteLoan(): void {static}
    + viewLoan(): void {static}
}

class Model {
  ' Campi (Attributi)
    - bookManagement : BookManagement
    - userManagement : UserManagement 
    - loanManagement : LoanManagement 
    
    ' Costruttori
    + Model(bookManagement: BookManagement, userManagement: UserManagement, loanManagement: LoanManagement)
    
    ' Metodi Getter
    + getBookManagement(): BookManagement
    + getUserManagement(): UserManagement
    + getLoanManagement(): LoanManagement
}

class Librarian implements Serializable {
  - username : String
  - password : String
  - credentials : File {readOnly}
    
    ' Metodi Pubblici
    + checkCredentials(usernameInput: String, passwordInput: String): boolean
    + modifyCredentials(newUsername: String, newPassword: String): void
    + getUsername(): String
    + getPassword(): String
    
  	' Metodo Privato (Funzione di Utilità)
    - hashPassword(password: String): String
}

class User implements Serializable, Comparable {
  ' Attributi (Campi)
  - name : String
  - surname : String
  - numberId : String
  - email : String
  - booksOnLoan : Map<Book, LocalDate>
  
  ' Costruttori
  + User(name: String, surname: String, numberId: String, email: String)
  + User(inputRicerca: String)
  
  ' Metodi Setter
  + setName(name: String): void
  + setSurname(surname: String): void
  + setEmail(email: String): void
  + setBooksOnLoan(newMap: TreeMap<Book, LocalDate>): void
  
  ' Metodi Getter
  + getName(): String
  + getSurname(): String
  + getNumberId(): String
  + getEmail(): String
  
  ' Metodi di Utility e Interfaccia
  + compareTo(other: User): int
  + findLoans(b: Book, data: LocalDate): void
  + equals(obj: Object): boolean
  + hashCode(): int
  + toString(): String
}

class Book implements Serializable, Comparable {
  ' Attributi (Campi)
  - title : String
  - authors : String
  - publicationYear : LocalDate
  - ISBN : String
  - availableCopies : int
  
  ' Costruttori
  + Book(title: String, authors: String, publicationYear: LocalDate, ISBN: String, availableCopies: int)
  + Book(inputRicerca: String)
  
  ' Metodi Getter
  + getTitle() : String
  + getAuthors() : String
  + getPublicationYear() : LocalDate
  + getISBN() : String
  + getAvailableCopies() : int
  
  ' Metodi Setter
  + setTitle(title : String) : void
  + setAuthors(authors : String) : void
  + setPublicationYear(publicationYear : LocalDate) : void
  + setISBN(ISBN : String) : void
  + setAvailableCopies(availableCopies : int) : void
  
  ' Metodi di Utility e Interfaccia
  + compareTo(other: Book): int
  + equals(obj: Object): boolean
  + hashCode(): int
  + toString(): String
}

class Loan implements Serializable, Comparable {
  ' Attributi (Campi)
  - book : Book
  - user : User
  - dueDate : LocalDate
  
  ' Costruttori
  + Loan (book: Book, user: User, dueDate: LocalDate)
  + Loan(inputRicerca1: String, inputRicerca2: String)
  
  ' Metodi Getter
  + getBook(): Book
  + getUser(): User
  + getDueDate(): LocalDate
  
  ' Metodi Setter
  + setBook(book: Book): void
  + setUser(user: User): void
  + setDueDate(dueDate: LocalDate): void
  
  ' Metodi Proxy/TableView (Accesso ai dati interni per FXML)
  + getName(): String
  + getSurname(): String
  + getNumberId(): String
  + getTitle(): String
  + getAuthors(): String
  + getISBN(): String
  
  ' Metodi di Utility e Interfaccia
  + compareTo(other: Loan): int
  + toString(): String
  + equals(obj: Object): boolean
  + hashCode(): int
}

interface Functionality<T> {
  + add(entity: T): boolean
  + remove(entity: T): boolean
  + update(entity1: T, entity2: T): boolean
  + viewSorted(): void
  + search(entity1: T): T
}

class BookManagement implements Functionality, Serializable {
  ' Attributi (Campi)
  - catalogue : Set<Book>
  - bookDatabase : File {readOnly}
  
  ' Costruttori
  + BookManagement()
  
  ' Metodi Pubblici (Implementazione Functionality)
  + add(b: Book): boolean
  + remove(b: Book): boolean
  + update(b1: Book, b2: Book): boolean
  + viewSorted(): void
  + search(b: Book): List<Book>
  
  ' Metodi Getter
  + getCatalogue(): Set<Book>
}

class LoanManagement implements Functionality, Serializable {
  ' Attributi (Campi)
  - loan : Set<Loan>
  - loanDatabase : File {readOnly}
  
  ' Costruttori
  + LoanManagement()
  
  ' Metodi Pubblici (Implementazione Functionality)
  + add(l: Loan): boolean
  + remove(l: Loan): boolean
  + update(newL: Loan, oldL: Loan): boolean
  + viewSorted(): void
  + search(l: Loan): List<Loan>
  
  ' Metodi Getter
  + getLoan(): Set<Loan>
}

class UserManagement implements Functionality, Serializable {
  ' Attributi (Campi)
  - list : Set<User> 
  - userDatabase : File {readOnly}
  
  ' Costruttori
  + UserManagement()
  
  ' Metodi Pubblici (Implementazione Functionality)
  + add(u: User): boolean
  + remove(u: User): boolean
  + update(u1: User, u2: User): boolean
  + viewSorted(): void
  + search(u: User): List<User>
  
  ' Metodi Getter
  + getList(): Set<User>
}

class FileManager<T> {
  ' Metodi per I/O di Oggetti Serializzati (File Binari: .dat)
  + {static} writeToTextFileObject(object: Set<T>, file: File): void
  + {static} updateFileObject(newTree: Set<T>, file: File): void
    
  ' Metodi per I/O Testuale (File di Testo: .txt)
  + {static} readLine(file: File): void
  + {static} writeLine(line: String, file: File): void
}

class LoginController {
  ' Attributi (Campi FXML e Modello)
  - librarian : Librarian
  - usernameField : TextField
  - passwordField : TextField
  - loginButton : Button
  - labelErrore : Label
  
  ' Metodi Pubblici/Handler (richiamati da FXML)
  + initialize(): void
  + handleLogin(): void
  + modifyCredentials(): void
}

class addBookController {
    ' Attributi (Campi FXML e Modello)
    - title : TextField
    - authors : TextField
    - publicationYear : TextField
    - ISBN : TextField
    - availableCopies : TextField
    - addButton : Button
    - labelErrore : Label
    - backButton : Button
    - model : Model
    
  	' Metodi Pubblici/Handler
    + setModel(model: Model): void
    + initialize(): void
    + addBook(): void
  	+ backPage(): void
}

class addLoanController {
    ' Attributi (Campi FXML e Modello/Gestori)
    - userComboBox : ComboBox<User>
    - bookComboBox : ComboBox<Book>
    - dueDatePicker : DatePicker
    - labelMessage : Label
  	- registerButton : Button
  	- userManagement : UserManagement
  	- bookManagement : BookManagement
  	- loanManagement : LoanManagement
  	- model : Model
  	- book : Book
  	- user : User
  	- duedate : LocalDate
  	- loan : Loan
    
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ registerLoan(): void
  	+ backPage(): void
}

class addUserController {
  	' Attributi (Campi FXML e Modello)
  	- name : TextField
  	- surname : TextField
  	- email : TextField
  	- numberID : TextField
  	- addButton : Button
  	- labelErrore : Label
  	- backButton : Button
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ isValidEmail(email: String): boolean
  	+ initialize(): void
  	+ addUser(): void
  	+ backPage(): void
}

class deleteBookController {
  	' Attributi (Campi FXML e Modello)
  	- backButton : Button
  	- searchField : TextField
  	- searchButton : Button
  	- deleteBookButton : Button
  	- bookTableViewricerca : TableView<Book>
  	- titoloColumn : TableColumn<Book, String>
  	- autoriColumn : TableColumn<Book, String>
  	- dataColumn : TableColumn<Book, String>
  	- isbnColumn : TableColumn<Book, String>
  	- copieColumn : TableColumn<Book, Integer>
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(url: URL, rb: ResourceBundle): void
  	+ handleSearchAction(event: ActionEvent): void
  	+ handleDeleteAction(event: ActionEvent): void
  	+ backPage(event: ActionEvent): void
  	
  	' Metodi Privati di Utility
  	- loadAllBooks(): void
  	- showAlert(title: String, message: String, type: AlertType): void
}

class deleteLoanController {
  	' Attributi (Campi FXML e Modello)
  	- userSearchField : TextField
  	- bookSearchField : TextField
  	- loanTableView : TableView<Loan>
  	- nomeColumn : TableColumn<Loan, String>
  	- cognomeColumn : TableColumn<Loan, String>
  	- matricolaColumn : TableColumn<Loan, String>
  	- autoriColumn : TableColumn<Loan, String>
  	- titoloColumn : TableColumn<Loan, String>
  	- isbnColumn : TableColumn<Loan, String>
  	- duedateColumn : TableColumn<Loan, LocalDate>
  	- labelMessage : Label
  	- confirmButton : Button
  	- userInput : String
  	- bookInput : String
  	- loanManagement : LoanManagement
  	- bookManagement : BookManagement
  	- loanList : List<Loan>
  	- loanSelezionato : Loan
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ search(): void
  	+ backPage(): void
}

class deleteUserController {
  	' Attributi (Campi FXML e Modello)
  	- searchField : TextField
  	- searchButtonu : Button
  	- deleteuserButton : Button
  	- backButton : Button
  	- userTableViewricerca : TableView<User>
  	- nomeColumn : TableColumn<User, String>
  	- cognomeColumn : TableColumn<User, String>
  	- matricolaColumn : TableColumn<User, String>
  	- labelMessage : Label
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ search(): void
  	+ delete(): void
  	+ backPage(): void
}

class homepageController {
  	' Attributi (Campi FXML per il Menu)
  	- aggiungiUtente : MenuItem
  	- modificaUtente : MenuItem
  	- cancellaUtente : MenuItem
  	- cercaUtente : MenuItem
  	- aggiungiLibro : MenuItem
  	- cancellaLibro : MenuItem
  	- modificaLibro : MenuItem
  	- cercaLibro : MenuItem
  	- aggiungiPrestito : MenuItem
  	- cancellaPrestito : MenuItem
  	- visualizzaElencoPrestito : MenuItem
  	- cercaPrestito : MenuItem
  	- model : Model
  	
  	' Metodi Pubblici/Handler (Navigazione)
  	+ addUser(): void
  	+ modifyUser(): void
  	+ deleteUser(): void
  	+ searchUser(): void
  	+ viewUser(): void
  	+ addBook(): void
  	+ deleteBook(): void
  	+ updateBook(): void
  	+ searchBook(): void
  	+ viewBooks(): void
  	+ addLoan(): void
  	+ searchLoan(): void
  	+ deleteLoan(): void
  	+ viewLoan(): void
}

class loanViewController {
  	' Attributi (Campi FXML e Modello)
  	- loanTableView : TableView<Loan>
  	- nomeColumn : TableColumn<Loan, String>
  	- cognomeColumn : TableColumn<Loan, String>
  	- matricolaColumn : TableColumn<Loan, String>
  	- autoriColumn : TableColumn<Loan, String>
  	- titoloColumn : TableColumn<Loan, String>
  	- isbnColumn : TableColumn<Loan, String>
  	- duedateColumn : TableColumn<Loan, LocalDate>
  	- loanManagement : LoanManagement
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ backPage(): void
}

class modifyBookController {
  	' Attributi (Campi FXML: Ricerca)
  	- backButton : Button
  	- labelMessage : Label
  	- searchField : TextField
  	- searchButton : Button
  	
  	' Attributi (Campi FXML: Form di modifica)
  	- titleField : TextField
  	- authorsField : TextField
  	- publicationYearField : TextField
  	- ISBNField : TextField
  	- availableCopiesField : TextField
  	- confirmButton : Button
  	
  	' Attributi (Logica Interna)
  	- model : Model
  	- currentBook : Book
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ initData(book: Book): void
  	+ search(event: ActionEvent): void
  	+ confirm(event: ActionEvent): void
  	+ backPage(event: ActionEvent): void
  	
  	' Metodi Privati di Utility
  	- setFieldsEditable(editable: boolean): void
  	- clearFields(): void
  	- populateFields(book: Book): void
}

class modifyUserController {
  	' Attributi (Campi FXML per Ricerca e Contenitori)
  	- searchPane : AnchorPane
  	- modifyPane : AnchorPane
  	- mainContainer : VBox
  	- searchField : TextField
  	- searchButton : Button
  	- userTableView : TableView<User>
  	- nomeColumn : TableColumn<User, String>
  	- cognomeColumn : TableColumn<User, String>
  	- matricolaColumn : TableColumn<User, String>
  	- labelMessageSearch : Label
  	
  	' Attributi (Campi FXML per Modifica)
  	- nameField : TextField
  	- surnameField : TextField
  	- emailField : TextField
  	- numberidField : TextField
  	- confirmButton : Button
  	- prestititenteButton : Button
  	- labelMessageModify : Label
  	
  	' Attributi (Logica Interna)
  	- risultato : User
  	- list : List<User>
  	- observableList : ObservableList<User>
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ search(): void
  	+ confirm(): void
  	+ backHomepage(): void
  	+ SearchPage(): void
  	
  	' Metodi Privati di Utility
  	- gestisciSelezione(userSelezionato: User): void
}

class modifycredentialController {
  	' Attributi (Campi FXML e Modello)
  	- librarian : Librarian
  	- pin : TextField
  	- usernameModified : TextField
  	- passwordModified : TextField
  	- confirmModified : Button
  	- labelMessage : Label
  	- backButton : Button
  	
  	' Metodi Pubblici/Handler
  	+ initialize(): void
  	- handleModify(): void
  	- handleBack(): void
}

class searchBookController implements Initializable {
  	' Attributi (Campi FXML: Ricerca e Controlli)
  	- searchField : TextField
  	- searchButton : Button
  	- backButton : Button
  	- labelMessage : Label
  	
  	' Attributi (Campi FXML: TableView)
  	- bookTableView : TableView<Book>
  	- titleColumn : TableColumn<Book, String>
  	- authorsColumn : TableColumn<Book, String>
  	- publicationYearColumn : TableColumn<Book, Integer>
  	- ISBNColumn : TableColumn<Book, String>
  	- copiesColumn : TableColumn<Book, Integer>
  	
  	' Attributi (Logica Interna)
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(url: URL, rb: ResourceBundle): void
  	+ search(event: ActionEvent): void
  	+ backPage(event: ActionEvent): void
}

class searchLoanController {
  	' Attributi (Campi FXML: Ricerca e Controlli)
  	- userSearchField : TextField
  	- bookSearchField : TextField
  	- labelMessage : Label
  	- confirmButton : Button
  	
  	' Attributi (Campi FXML: TableView)
  	- loanTableView : TableView<Loan>
  	- nomeColumn : TableColumn<Loan, String>
  	- cognomeColumn : TableColumn<Loan, String>
  	- matricolaColumn : TableColumn<Loan, String>
  	- autoriColumn : TableColumn<Loan, String>
  	- titoloColumn : TableColumn<Loan, String>
  	- isbnColumn : TableColumn<Loan, String>
  	- duedateColumn : TableColumn<Loan, LocalDate>
  	
  	' Attributi (Logica Interna)
  	- userInput : String
  	- bookInput : String
  	- loanManagement : LoanManagement
  	- model : Model
  	- loanList : List<Loan>
  	- loan : Loan
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ search(): void
  	+ backPage(): void
}

class searchUserController {
  	' Attributi (Campi FXML: Ricerca e Controlli)
  	- searchField : TextField
  	- searchButtonu : Button
  	- labelMessage : Label
  	- backButton : Button
  	
  	' Attributi (Campi FXML: TableView)
  	- userTableViewricerca : TableView<User>
  	- nomeColumn : TableColumn<User, String>
  	- cognomeColumn : TableColumn<User, String>
  	- matricolaColumn : TableColumn<User, String>
  	- emailColumn : TableColumn<User, String>
  	- mapColumn : TableColumn<User, String>
  	
  	' Attributi (Logica Interna)
  	- userList : ObservableList<User>
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ search(): void
  	+ backPage(): void
}

class viewBookController implements Initializable {
  	' Attributi (Campi FXML: Controlli e TableView)
  	- backButton : Button
  	- bookTableView : TableView<Book>
  	
  	' Attributi (Campi FXML: Colonne)
  	- titoloColumn : TableColumn<Book, String>
  	- autoriColumn : TableColumn<Book, String>
  	- annoPubblicazioneColumn : TableColumn<Book, String>
  	- isbnColumn : TableColumn<Book, String>
  	- copieDisponibiliColumn : TableColumn<Book, Integer>
  	
  	' Attributi (Logica Interna)
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(url: URL, rb: ResourceBundle): void
  	+ backPage(event: ActionEvent): void
  	
  	' Metodi Privati di Utility
  	- loadAllBooks(): void
}

class viewUserController {
  	' Attributi (Campi FXML: Controlli e TableView)
  	- userTableView : TableView<User>
  	- backButton : Button
  	
  	' Attributi (Campi FXML: Colonne)
  	- nomeColumn : TableColumn<User, String>
  	- cognomeColumn : TableColumn<User, String>
  	- matricolaColumn : TableColumn<User, String>
  	- emailColumn : TableColumn<User, String>
  	- mapColumn : TableColumn<User, String>
  	
  	' Attributi (Logica Interna)
  	- model : Model
  	
  	' Metodi Pubblici/Handler
  	+ setModel(model: Model): void
  	+ initialize(): void
  	+ backPage(): void
}

' === Ereditarietà e implementazione ===
View --|> Application
User --|> Serializable
Book --|> Serializable
Loan --|> Serializable
Librarian --|> Serializable
Book --|> Comparable
Loan --|> Comparable
BookManagement ..|> Functionality
LoanManagement ..|> Functionality
UserManagement ..|> Functionality

' === Composizione ===
Model *-- BookManagement
Model *-- LoanManagement
Model *-- UserManagement
Model *-- Librarian

' === Associazioni ===
Loan --> Book : book [1]
Loan --> User : user [1]
User "1" *-- "0..*" Loan : booksOnLoan
BookManagement "1" *-- "0..*" Book : catalogue
LoanManagement "1" *-- "0..*" Loan : loan
UserManagement "1" *-- "0..*" User : list

' === Dipendenze ===
addBookController ..> Model : uses
addLoanController ..> Model : uses
addUserController ..> Model : uses
deleteBookController ..> Model : uses
deleteLoanController ..> Model : uses
deleteUserController ..> Model : uses
modifyBookController ..> Model : uses
modifyUserController ..> Model : uses
searchBookController ..> Model : uses
searchLoanController ..> Model : uses
searchUserController ..> Model : uses
viewBookController ..> Model : uses
viewUserController ..> Model : uses
loanViewController ..> Model : uses
homepageController ..> View : uses
addBookController ..> View : uses
addLoanController ..> View : uses
addUserController ..> View : uses
deleteBookController ..> View : uses
deleteLoanController ..> View : uses
deleteUserController ..> View : uses
modifyBookController ..> View : uses
modifyUserController ..> View : uses
searchBookController ..> View : uses
searchLoanController ..> View : uses
searchUserController ..> View : uses
viewBookController ..> View : uses
viewUserController ..> View : uses
loanViewController ..> View : uses
LoginController ..> View : uses
LoginController ..> Librarian : uses
modifycredentialController ..> Librarian : uses
modifycredentialController ..> View : uses
Model ..> FileManager : uses
BookManagement ..> FileManager : uses
LoanManagement ..> FileManager : uses
UserManagement ..> FileManager : uses
Librarian ..> FileManager : uses

@enduml